<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Language" content="ja" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <title>コダックメーカー</title>
  <!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  </head>
  <body>
    <p><img src="Psyduck-logo.png" width="300" height="80"></p>

    <p>
      <table>
      <tr>

        <!--
        <td><button type="submit" name="button1"><img src="Psyduck1.png" alt="通常" width="150" height="110"/></button><p>通常</td>
        -->
        <td><input type="image" src="Psyduck1.png" name="button1" alt="通常" width="150" height="110" onCLick="click_Btn('button1','通常')"><p>通常</td>
        <td><input type="image" src="Psyduck2.png" name="button2" alt="頭をかかえる(左)" width="150" height="110" onCLick="click_Btn('button2','頭をかかえる(左)')"><p>頭をかかえる(左)</td>
        <td><input type="image" src="Psyduck3.png" name="button3" alt="頭をかかえる(右)" width="150" height="110" onCLick="click_Btn('button3','頭をかかえる(右)')"><p>頭をかかえる(右)</td>
        <td><input type="image" src="Psyduck4.png" name="button4" alt="目をつむる" width="150" height="110" onCLick="click_Btn('button4','目をつむる')"><p>目をつむる</td>
      </tr><tr>
        <td><input type="image" src="Psyduck5.png" name="button5" alt="諦める" width="150" height="110" onCLick="click_Btn('button5','諦める')"><p>諦める</td>
        <td><input type="image" src="Psyduck6.png" name="button6" alt="両手を広げる" width="150" height="110" onCLick="click_Btn('button6','両手を広げる')"><p>両手を広げる</td>
        <td><input type="image" src="Psyduck7.png" name="button7" alt="覚醒" width="150" height="110" onCLick="click_Btn('button7','覚醒')"><p>覚醒</td>
      </tr>
      </table>
    </p>
    <p><canvas id="psyduck-canvas" width="300" height="220"></canvas></p>
    <input type="text" name="text" size="30" maxlength="9" onInput="alertValue(this)">
    <input type="submit" name="submit" value="画像を保存" onclick="submit();">

    <script>
    var selected = "";
    function click_Btn(str,alt){
      selected = str;
      draw();
    }
    function submit(){
      var elements = document.getElementsByName("text");
      var text = elements[0].value;
      var img_num = selected.slice(selected.length-1);
      var imageName = "Psyduck" + img_num + ".png"
      location.href="result.html?text="+escape(text)+"&image="+escape(imageName);
    }
    onload = function() {
      var elements = document.getElementsByName("button1");
      selected = "button1";
      draw();
    };
    function draw() {
      var elements = document.getElementsByName("text");
      var text = elements[0].value;
      var img_num = selected.slice(selected.length-1);
      var imageName = "Psyduck" + img_num + ".png"
      /* canvas要素のノードオブジェクト */
      var canvas = document.getElementById('psyduck-canvas');
      /* canvas要素の存在チェックとCanvas未対応ブラウザの対処 */
      if ( ! canvas || ! canvas.getContext ) {
        return false;
      }
      /* 2Dコンテキスト */
      var ctx = canvas.getContext('2d');
      /* Imageオブジェクトを生成 */
      var img = new Image();
      img.src = imageName;
      /* 画像が読み込まれるのを待ってから処理を続行 */
      img.onload = function() {
        ctx.drawImage(img, 0, 0,300,220);
        //ctx2.fillText('fillText(text,x,y[,maxWidth])',15,55,520);
        //ctx.font= 'normal 82px Century Gothic,"Hiragino Kaku Gothic ProN", ヒラギノ角ゴ ProN W3"';
        ctx.font= 'normal 22px "HiraginoSans-W0"';
        ctx.textAlign = 'center';
        ctx.fillStyle = "#48656c";
        ctx.fillText(text,150,202);
      }
    }
    function alertValue($this) {
      draw();
    }
    </script>
  </body>
</html>
